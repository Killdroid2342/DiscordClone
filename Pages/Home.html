<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Discord</title>
  <link rel="icon" href="../assets/img/titlePic.png" sizes="32x32" type="image/png" />
  <link rel="stylesheet" href="../css/Home.css" />
  <script src="../JS/Home.js?v=89" defer></script>
</head>

<body>
  <div id="audioPermBanner"
    style="display:none; position:fixed; top:0; left:0; width:100%; height: 50px; background: #f04747; color: white; text-align: center; line-height: 50px; font-weight: bold; z-index: 99999; cursor: pointer; border-bottom: 2px solid #8e2020;">
    üéµ Sound Blocked! Click anywhere on this screen to enable ringtone. üéµ
  </div>
  <div class="outerModalMessage">
    <div class="innerModalMessage">
      <p class="ContentMessage"></p>
    </div>
  </div>
  <div class="sections">
    <div class="allservers">
      <img src="/assets/img/home.png" class="servers" id="home" onclick="clearContent()" />
      <img src="/assets/img/addServer.png" class="servers" id="openModalBtn" onclick="openModal()" />
    </div>
    <div class="secondColumn">
      <form action="" class="inputForm">
        <input class="textInput" type="text" name="" id="" placeholder="Find or start a conversation" />
      </form>
      <div class="positionSecond">
        <div class="friendsDiv">
          <img src="/assets/img/friendsImg.png" alt="" class="topImages" />
          <p class="friends" id="seeFriends">Friends</p>
        </div>
        <div class="smallHead">
          <p>Direct Message</p>
          <p class="plus">+</p>
        </div>
        <div class="MainFriendsDiv">
          <p class="testaddeduser"></p>
        </div>
      </div>
      <div class="account">
        <p id="username"></p>
        <button class="call-control-btn" onclick="Mute()">Mute</button>
        <button class="call-control-btn" onclick="Deafen()">Deafen</button>
        <button class="call-control-btn danger" onclick="LeaveCall()">Leave Call</button>
      </div>
    </div>
    <div class="lastSection">
      <div class="nav">
        <p class="navText" onclick="ShowFriendsMainView()">All</p>
        <p class="navText" onclick="showPendingRequests()">Pending</p>
        <p class="navText" onclick="showDeleteFriend()">Remove Friend</p>
        <p class="addFriend" onclick="showAddFriends()">Add Friend</p>
        <button onclick="LogOut()" class="logOut">Log Out</button>
      </div>
      <div class="pendingRequestsDiv" style="display: none">
        <p class="addFriendHeader">PENDING REQUESTS</p>
        <div class="pendingList"></div>
      </div>
      <div class="addFriendsDiv">
        <p class="addFriendHeader">ADD FRIEND</p>
        <p class="addFriendText">
          You can add friends with their Discord usernames
        </p>
        <form action="" class="addFriendsForm" onsubmit="SearchFriends(event)">
          <input type="text" placeholder="You can add friends with their Discord usernames" class="friendsInput"
            name="friendUsername" />
          <button type="submit" class="friendsButton">
            Send Friend Request
          </button>
        </form>
      </div>
      <div class="removeFriendsDiv">
        <p class="removeFriendHeader">REMOVE FRIEND</p>
        <p class="removeFriendText">
          You can remove friends with their Discord usernames
        </p>
        <form action="" class="removeFriendsForm" onsubmit="RemoveFriends(event)">
          <input type="text" placeholder="You can add friends with their Discord usernames" class="friendsInput"
            name="friendUsername" />
          <button type="submit" class="removeFriendsButton">
            Remove Friend
          </button>
        </form>
      </div>


      <div class="privateMessage">
        <div id="preCallUI">
          <div style="display: flex; flex-direction: row; align-items: center;">
            <h2 class="messageUser"></h2>

          </div>
          <div class="header-controls">
            <button class="header-btn" onclick="startPrivateCall()" title="Start Voice Call">üìû</button>

            <form action="" class="search-form">
              <input type="text" placeholder="Search" class="search-bar" />
              <span class="search-icon">üîç</span>
            </form>
          </div>
        </div>

        <div id="activeCallUI" style="display: none; background-color: #000000;">
          <div style="
                display: flex;
                flex-direction: row;
                border: 1px solid red;
                justify-content: space-between;
              ">
            <div style="
                  display: flex;
                  flex-direction: row;
                ">
              <h2 class="messageUser" id="activeCallUsername" style="color: white;"></h2>
            </div>

          </div>
          <div>
            <h2 id="centerCallUser" style="text-align: center; color: white; margin-top: 10px; font-size: 2em;"></h2>

            <div id="videoContainer"
              style="position: relative; display: flex; flex-direction: row; justify-content: center; align-items: center; height: 60vh; width: 100%;">
              <video id="remoteVideo" autoplay playsinline
                style="width: 48%; height: 100%; background: black; margin: 5px; object-fit: cover;"></video>
              <video id="localVideo" autoplay playsinline muted
                style="width: 48%; height: 100%; background: #222; margin: 5px; object-fit: cover;"></video>

              <div id="videoDebug"
                style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: lime; padding: 10px; pointer-events: none; font-family: monospace; font-size: 12px; z-index: 1000; border-radius: 4px;">
                Waiting for diagnostics...
              </div>
            </div>

            <div
              style="display: flex; flex-direction: row; justify-content: center; margin-top: 20px; padding-bottom: 20px;">
              <button class="call-control-btn" onclick="Mute()">Mute/Unmute</button>
              <button class="call-control-btn" onclick="ToggleVideo()">Video</button>
              <button class="call-control-btn" onclick="ShareScreen()">Share Screen</button>
              <button class="call-control-btn danger" onclick="endPrivateCall()">End Call</button>
            </div>
          </div>
        </div>
        <div class="messagesDisplay"></div>
        <form action="" class="privateMessageForm" onsubmit="PrivateMessage(event)">
          <div class="chat-input-container">
            <button type="button" class="chat-attach-btn" title="Upload a file">
              <div class="plus-icon">+</div>
            </button>
            <input type="text" name="friendMessagesData" class="chatInput" placeholder="Message" autocomplete="off" />
            <div class="chat-input-icons">

              <button type="button" class="chat-icon-btn">üòä</button>
            </div>

            <button type="submit" style="display: none;"></button>
          </div>
        </form>
      </div>



      <div class="friendsMainView" style="display: none;">
        <form action="" class="friendsSearchForm">
          <input type="text" placeholder="Search" class="friendsSearchInput" />
        </form>
        <p class="friendsHeader">ALL FRIENDS ‚Äî <span id="friendsCount">0</span></p>
        <div class="friendsListMain">

        </div>
      </div>

    </div>



    <div id="serverDetails" class="CurrentServer">
      <div class="CurrentServerMenu">
        <h1 class="currentServerName"></h1>

        <div id="channelsList" style="overflow-y: auto; flex-grow: 1"></div>

        <div class="account" style="
              margin-top: 10px;
              padding-top: 10px;
              border-top: 1px solid #202225;
            ">
          <p id="inServerUsername" style="margin-bottom: 5px">USERNAME</p>
          <div style="display: flex; gap: 5px; flex-wrap: wrap">
            <button class="call-control-btn" onclick="VideoOn()">Video On</button>
            <button class="call-control-btn" onclick="VideoOff()">Video Off</button>
            <button class="call-control-btn" onclick="Mute()">Mute</button>
            <button class="call-control-btn" onclick="Deafen()">Deafen</button>
            <button class="call-control-btn" onclick="ShareScreen()">Share Screen</button>
            <button class="call-control-btn danger" onclick="LeaveCall()">Leave</button>
          </div>
        </div>

        <button onclick="getInviteLink(selectedServerID)" class="inviteBtn" style="margin-top: 10px">
          üìé Invite
        </button>
      </div>
      <div class="chatSection">
        <p class="chatHeader">Text Channel</p>
        <div class="videoBox">
          <video class="videos" id="localVideo" autoplay muted></video>
          <div id="remoteVideosContainer"></div>
        </div>

        <div class="chatMessages"></div>
        <form action="" class="chatForm" onsubmit="ServerChat(event)">
          <input type="text" name="userText" class="chatInput" placeholder="Message" />
          <button class="formButton">Send</button>
        </form>
      </div>

      <div class="viewServerAccounts">
        <p class="serverAccounts">Accounts</p>
      </div>
    </div>
  </div>

  <div class="outerModal">
    <div class="innerModal">
      <p onclick="closeModal()" class="close">x</p>
      <h2 class="CreateServerHead">Create Your Server</h2>
      <p class="modalSubhead">
        Your server is where you and your friends hang out. Make yours and
        start talking.
      </p>

      <button class="createServer" onclick="openSecondModal()">
        Create My Own
      </button>

      <div class="secondInnerModal">
        <h2 class="altHead">Already have an invite</h2>
        <button class="joinAServer" onclick="openJoinModal()">
          Join a Server
        </button>
      </div>
    </div>
  </div>
  <div class="outerJoinModal" style="display: none">
    <div class="innerJoinModal">
      <p class="closeJoin" onclick="closeJoinModal()">x</p>
      <h2 class="joinServerHead">Join a Server</h2>
      <p class="joinServerSubhead">Enter Invite Link</p>

      <form onsubmit="JoinServer(event)" class="joinForm">
        <label>Invite Link</label>
        <input type="text" id="serverLinkInput" class="inviteLinkInput"
          placeholder="e.g. https://localhost:7170/invite/12345" />

        <button type="submit" class="joinButton">Join</button>
      </form>
    </div>
  </div>

  <div class="outerSecondModal">
    <div class="innerSecondModal">
      <p class="closeSecond" onclick="closeSecondModal()">x</p>
      <h2 class="CreateSecondServerHead">Create Your Own Server</h2>
      <p class="modalSecondSubhead">
        In order to help you with your setup, is your new server for just a
        few friends or a larger community
      </p>
      <button class="createServer" onclick="OpenCreationModal()">
        For me and my friends
      </button>
      <p class="backSecondModal" onclick="BackToFirstModal()">Back</p>
    </div>
  </div>

  <div class="outerCreationModal">
    <div class="innerCreationModal">
      <p class="closeThird" onclick="CloseCreationModal()">x</p>
      <h2 class="CreateCreationServerHead">Customize Your Server</h2>
      <p class="modalCreationSubhead">
        Give your new server a personality with a name
      </p>
      <form onsubmit="CreateServer(event)" class="form">
        <label for="serverNameInput" class="serverName">SERVER NAME</label>
        <input type="text" id="serverNameInput" class="serverInput" />
        <div class="creationFlex">
          <p class="creationBack" onclick="BackLastModal()">Back</p>
          <button type="submit" class="createServerbtn">Create</button>
        </div>
      </form>
    </div>
  </div>


  <div id="incomingCallModal" class="outerModal" style="display: none; z-index: 1000;">
    <div class="innerModal" style="height: auto; text-align: center; padding: 20px;">
      <h2 style="color: white; margin-bottom: 10px;">Incoming Call</h2>
      <p id="incomingCallUser" style="color: #b9bbbe; font-size: 1.2em; margin-bottom: 20px;"></p>
      <div style="display: flex; justify-content: center; gap: 20px;">
        <button onclick="AcceptCall()"
          style="background-color: #3ba55c; padding: 10px 30px; color: white; border: none; border-radius: 3px; cursor: pointer; font-weight: bold;">Accept</button>
        <button onclick="DeclineCall()"
          style="background-color: #ed4245; padding: 10px 30px; color: white; border: none; border-radius: 3px; cursor: pointer; font-weight: bold;">Decline</button>
      </div>
    </div>
  </div>

  <script src="/node_modules/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
  <script src="/JS/Auth.js?v=2"></script>
</body>

</html>